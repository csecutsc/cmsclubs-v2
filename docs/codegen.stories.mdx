import { Meta, Title, Description } from '@storybook/addon-docs/blocks';

<Meta title='Documentation/3. Codegen' />

<Title>Codegen</Title>
<Description>What is it and why is here?</Description>

<div style={{ margin: `2rem 0` }} />

## What is codegen?

Codegen is a folder which contains a range of "plugins" which are automatically loaded by `/codegen/index.js`.
This allows for us to automatically generate code between different extensions (.scss <-> .js <-> .js), and
environments (package.json <-> gatsby pre-start <-> gatsby build step <-> development server), automagically.

<div style={{ margin: `3rem 0` }} />

## How to create a "plugin"

1. Create a folder within `/codegen`, with an `index.js` inside the folder - this file would be the handle for codegen.
2. Your file would have a default export (ie. `module.exports`), which is a function which returns a Promise.
   - The promise is important as it lets codegen know whether the work of the plugin is done before
     starting Gatsby's build-step for development and/or production.
3. That's it, the plugin is ready and would automatically be loaded and run by the `npm run generate`.

<div style={{ margin: `3rem 0` }} />

## Files to know

| File       | Description                                                                          |
| ---------- | ------------------------------------------------------------------------------------ |
| `index.js` | Contains the code which orchestrates the discovery, loading, and awaiting of plugins |
| `env.js`   | Variables shared between plugins and/or used in areas of the code not within `src`   |

<div style={{ margin: `3rem 0` }} />

## Current plugins

Note that all variables mentioned here is from `/codegen/env.js` and not `.env`

| Plugin  | Description                                                                                                                                                                                                   |
| ------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `color` | Takes `PRIMARY_COLOR` and generates `_color.scss`. This abstraction allows us to use it in `logo` and `gatsby-config.js` to use the same primary color for the manifest and logo of the site                  |
| `fonts` | Takes `FONT` as font family name, and generates the `@font-face` in `_fonts.scss` and static folder. This allows for us to change fonts easily and quickly without having to mannual rewrite the `@font-face` |
| `logo`  | Generates `logo.svg` so that it uses the right color. It's kinda basic, but it helps with consistency of variables                                                                                            |

<div style={{ margin: `3rem 0` }} />

## Improvements for the future

- Expand the API to have "integration" with `gatsby clean`, which would remove all the files which are generated by codegen
- Add caching to Netlify via a Netlify plugin - save on build time
- Add caching to local code (put that stuff in `.cache`), this might go hand in hand with caching for build
